<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      An√°lise por Estados - PEC da Bandidagem | Mapa Interativo Brasil
    </title>
    <meta
      name="description"
      content="An√°lise regional da vota√ß√£o da PEC da Bandidagem por estados. Mapa interativo e rankings dos 27 estados + DF. Veja padr√µes geogr√°ficos de aprova√ß√£o." />
    <meta
      name="keywords"
      content="estados Brasil, regi√µes, mapa vota√ß√£o, Tocantins, Piau√≠, Sergipe, Rio Grande do Sul, PEC da Bandidagem" />
    <meta
      property="og:title"
      content="An√°lise por Estados - PEC da Bandidagem" />
    <meta
      property="og:description"
      content="Explore como cada estado brasileiro votou na PEC da Bandidagem. Mapa interativo e an√°lise regional detalhada." />
    <meta
      property="og:url"
      content="https://pec-bandidagem.vercel.app/estados.html" />
    <link
      rel="canonical"
      href="https://pec-bandidagem.vercel.app/estados.html" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-P47CK1TDL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-P47CK1TDL8");
    </script>
    <script src="analytics.js"></script>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body class="estados">
    <!-- GitHub Fork Ribbon -->
    <a
      class="github-fork-ribbon"
      href="https://github.com/fcavalcantirj/pec-bandidagem"
      data-ribbon="Fork me on GitHub"
      title="Fork me on GitHub"
      >Fork me on GitHub</a
    >

    <div class="header">
      <h1>üó∫Ô∏è PEC da Bandidagem</h1>
      <p>‚ö†Ô∏è ALERTA: Estados que Mais Aprovaram a PEC</p>
      <nav class="nav">
        <a href="index.html">üè† In√≠cio</a>
        <a href="deputados.html">üë• Deputados</a>
        <a href="partidos.html">üéØ Partidos</a>
        <a href="estados.html" class="active">üó∫Ô∏è Estados</a>
        <a href="fluxo.html">üîÑ Fluxo</a>
        <a href="relatorio.html">üìã Relat√≥rio</a>
        <a href="despesas.html">üí∞ Despesas</a>
      </nav>
    </div>

    <div class="container">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="total-states">27</div>
          <div class="stat-label">Estados + DF</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="unanimous-states">2</div>
          <div class="stat-label">Estados com 100% Aprova√ß√£o</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="divided-states">4</div>
          <div class="stat-label">Estados Divididos (‚â§60%)</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="avg-approval">73%</div>
          <div class="stat-label">Aprova√ß√£o M√©dia Nacional</div>
        </div>
      </div>

      <div class="chart-container">
        <h2 class="chart-title" style="color: #dc2626">
          üö® Mapa dos Estados que Aprovaram a PEC
        </h2>
        <p class="chart-subtitle" style="color: #7f1d1d; font-weight: 600">
          ‚ö†Ô∏è Estados em vermelho aprovaram a PEC (clique para detalhes)
        </p>

        <div class="controls">
          <button class="control-button active" onclick="showRound(2)">
            2¬∫ Turno
          </button>
          <button class="control-button" onclick="showRound(1)">
            1¬∫ Turno
          </button>
        </div>

        <div id="brazil-map"></div>

        <div class="map-legend">
          <div class="legend-item">
            <div class="legend-color" style="background: #dc2626"></div>
            <span>‚â•90% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ef4444"></div>
            <span>80-89% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #f59e0b"></div>
            <span>70-79% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #eab308"></div>
            <span>60-69% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #3b82f6"></div>
            <span>40-59% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #10b981"></div>
            <span>20-39% Aprova√ß√£o</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #065f46"></div>
            <span><20% Aprova√ß√£o</span>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <h2 class="chart-title" style="color: #dc2626">
          üö® Ranking dos Estados que Mais Aprovaram
        </h2>
        <p class="chart-subtitle" style="color: #7f1d1d; font-weight: 600">
          ‚ö†Ô∏è Estados ordenados por maior aprova√ß√£o da PEC
        </p>

        <svg id="state-ranking" width="100%" height="600"></svg>
      </div>

      <div class="chart-container">
        <h2 class="chart-title" style="color: #dc2626">
          üö® Regi√µes que Mais Aprovaram a PEC
        </h2>
        <p class="chart-subtitle" style="color: #7f1d1d; font-weight: 600">
          ‚ö†Ô∏è Padr√µes regionais de aprova√ß√£o da PEC
        </p>

        <div class="region-analysis" id="region-analysis">
          <!-- Regions will be populated by JavaScript -->
        </div>
      </div>

      <div class="chart-container">
        <h2 id="comparison-title" class="chart-title" style="color: #dc2626">
          üö® Aumento da Aprova√ß√£o entre Turnos
        </h2>
        <p
          id="comparison-subtitle"
          class="chart-subtitle"
          style="color: #7f1d1d; font-weight: 600">
          ‚ö†Ô∏è Como a aprova√ß√£o da PEC aumentou no 2¬∫ turno
        </p>

        <svg id="comparison-chart" width="100%" height="400"></svg>
      </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script src="data.js"></script>
    <script>
      // Mobile responsiveness functions
      function isMobile() {
        return window.innerWidth <= 768;
      }

      function getMobileMargins() {
        if (window.innerWidth <= 480) {
          return { top: 20, right: 20, bottom: 80, left: 60 };
        } else if (window.innerWidth <= 768) {
          return { top: 20, right: 30, bottom: 90, left: 80 };
        }
        return { top: 40, right: 40, bottom: 100, left: 120 };
      }

      function getMobileHeight() {
        if (window.innerWidth <= 480) {
          return 400;
        } else if (window.innerWidth <= 768) {
          return 500;
        }
        return 600;
      }

      // Brazilian states mapping and regions
      const stateRegions = {
        AC: { name: "Acre", region: "Norte" },
        AL: { name: "Alagoas", region: "Nordeste" },
        AP: { name: "Amap√°", region: "Norte" },
        AM: { name: "Amazonas", region: "Norte" },
        BA: { name: "Bahia", region: "Nordeste" },
        CE: { name: "Cear√°", region: "Nordeste" },
        DF: { name: "Distrito Federal", region: "Centro-Oeste" },
        ES: { name: "Esp√≠rito Santo", region: "Sudeste" },
        GO: { name: "Goi√°s", region: "Centro-Oeste" },
        MA: { name: "Maranh√£o", region: "Nordeste" },
        MT: { name: "Mato Grosso", region: "Centro-Oeste" },
        MS: { name: "Mato Grosso do Sul", region: "Centro-Oeste" },
        MG: { name: "Minas Gerais", region: "Sudeste" },
        PA: { name: "Par√°", region: "Norte" },
        PB: { name: "Para√≠ba", region: "Nordeste" },
        PR: { name: "Paran√°", region: "Sul" },
        PE: { name: "Pernambuco", region: "Nordeste" },
        PI: { name: "Piau√≠", region: "Nordeste" },
        RJ: { name: "Rio de Janeiro", region: "Sudeste" },
        RN: { name: "Rio Grande do Norte", region: "Nordeste" },
        RS: { name: "Rio Grande do Sul", region: "Sul" },
        RO: { name: "Rond√¥nia", region: "Norte" },
        RR: { name: "Roraima", region: "Norte" },
        SC: { name: "Santa Catarina", region: "Sul" },
        SP: { name: "S√£o Paulo", region: "Sudeste" },
        SE: { name: "Sergipe", region: "Nordeste" },
        TO: { name: "Tocantins", region: "Norte" },
      };

      let currentRound = 2;
      let statesData = [];

      // Use embedded data to avoid CORS issues
      function loadData() {
        const data = VISUALIZATION_DATA;

        // Convert state data to array
        statesData = Object.entries(data.states)
          .map(([code, stats]) => ({
            code: code,
            name: stateRegions[code]?.name || code,
            region: stateRegions[code]?.region || "Unknown",
            round1_approval: stats.round1_approval,
            round2_approval: stats.round2_approval,
            round1_total: stats.round1_total,
            round2_total: stats.round2_total,
            round1_sim: stats.round1.Sim,
            round1_nao: stats.round1.N√£o,
            round2_sim: stats.round2.Sim,
            round2_nao: stats.round2.N√£o,
          }))
          .filter((d) => d.round1_total > 0 || d.round2_total > 0);

        // Color scale based on approval level
        function getStateColor(approval) {
          if (approval >= 90) return "#dc2626"; // Dark red - Massive approval (very concerning)
          if (approval >= 80) return "#ef4444"; // Red - High approval (concerning)
          if (approval >= 70) return "#f59e0b"; // Orange - Moderate-high approval (concerning)
          if (approval >= 60) return "#eab308"; // Yellow - Moderate approval (concerning)
          if (approval >= 40) return "#3b82f6"; // Blue - Low-moderate approval (better)
          if (approval >= 20) return "#10b981"; // Green - Low approval (good)
          return "#065f46"; // Dark green - Very low approval (excellent)
        }

        function showRound(round) {
          currentRound = round;

          // Update button states
          d3.selectAll(".control-button").classed("active", false);
          d3.select(`[onclick="showRound(${round})"]`).classed("active", true);

          updateMap();
          createStateRanking();

          // Update comparison chart title and subtitle based on selected round
          if (round === 1) {
            document.getElementById("comparison-title").textContent =
              "üîç An√°lise do 1¬∫ Turno por Estado";
            document.getElementById("comparison-subtitle").textContent =
              "üìä Dados de aprova√ß√£o do primeiro turno da PEC";
          } else {
            document.getElementById("comparison-title").textContent =
              "üö® Aumento da Aprova√ß√£o entre Turnos";
            document.getElementById("comparison-subtitle").textContent =
              "‚ö†Ô∏è Como a aprova√ß√£o da PEC aumentou no 2¬∫ turno";
          }

          // Recreate comparison chart to update data
          createComparisonChart();
        }

        function updateMap() {
          // Simplified Brazil map (using state rectangles as placeholder)
          // In production, you would load actual GeoJSON/TopoJSON data
          createSimplifiedMap();
        }

        function createSimplifiedMap() {
          const container = d3.select("#brazil-map");
          container.selectAll("*").remove();

          const width = 800;
          const height = 600;
          const padding = 20;

          const svg = container
            .append("svg")
            .attr("width", "100%")
            .attr("height", height)
            .attr("viewBox", `0 0 ${width} ${height}`)
            .style("max-width", "800px")
            .style("margin", "0 auto")
            .style("display", "block");

          // Create a grid layout for states
          const cols = 6;
          const rows = Math.ceil(statesData.length / cols);
          const cellWidth = (width - 2 * padding) / cols;
          const cellHeight = (height - 2 * padding) / rows;

          // Sort states by region and name for consistent layout
          const sortedStates = [...statesData].sort((a, b) => {
            if (a.region !== b.region) {
              const regionOrder = [
                "Norte",
                "Nordeste",
                "Centro-Oeste",
                "Sudeste",
                "Sul",
              ];
              return (
                regionOrder.indexOf(a.region) - regionOrder.indexOf(b.region)
              );
            }
            return a.name.localeCompare(b.name);
          });

          svg
            .selectAll(".state")
            .data(sortedStates)
            .enter()
            .append("rect")
            .attr("class", "state")
            .attr("x", (d, i) => padding + (i % cols) * cellWidth + 5)
            .attr(
              "y",
              (d, i) => padding + Math.floor(i / cols) * cellHeight + 5
            )
            .attr("width", cellWidth - 10)
            .attr("height", cellHeight - 10)
            .attr("rx", 8)
            .attr("fill", (d) => {
              const approval =
                currentRound === 2 ? d.round2_approval : d.round1_approval;
              return getStateColor(approval);
            })
            .on("mouseover", function (event, d) {
              const approval =
                currentRound === 2 ? d.round2_approval : d.round1_approval;
              const total =
                currentRound === 2 ? d.round2_total : d.round1_total;
              const sim = currentRound === 2 ? d.round2_sim : d.round1_sim;
              const nao = currentRound === 2 ? d.round2_nao : d.round1_nao;

              const tooltip = d3.select("#tooltip");
              tooltip
                .style("opacity", 1)
                .html(
                  `
                                <strong>${d.name} (${d.code})</strong><br/>
                                Regi√£o: ${d.region}<br/>
                                Aprova√ß√£o: ${approval.toFixed(1)}%<br/>
                                Votos SIM: ${sim}/${total}<br/>
                                Votos N√ÉO: ${nao}/${total}
                            `
                )
                .style("left", event.pageX + 10 + "px")
                .style("top", event.pageY - 10 + "px");
            })
            .on("mouseout", function () {
              d3.select("#tooltip").style("opacity", 0);
            })
            .on("click", function (event, d) {
              alert(
                `Detalhes de ${d.name}:\\n` +
                  `1¬∫ Turno: ${d.round1_approval.toFixed(1)}% (${
                    d.round1_sim
                  }/${d.round1_total})\\n` +
                  `2¬∫ Turno: ${d.round2_approval.toFixed(1)}% (${
                    d.round2_sim
                  }/${d.round2_total})`
              );
            });

          // Add state labels
          svg
            .selectAll(".state-label")
            .data(sortedStates)
            .enter()
            .append("text")
            .attr("class", "state-label")
            .attr(
              "x",
              (d, i) => padding + (i % cols) * cellWidth + cellWidth / 2
            )
            .attr(
              "y",
              (d, i) =>
                padding + Math.floor(i / cols) * cellHeight + cellHeight / 2 - 5
            )
            .attr("text-anchor", "middle")
            .style("font-size", "12px")
            .style("font-weight", "bold")
            .style("fill", "white")
            .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.5)")
            .text((d) => d.code);

          // Add approval percentage
          svg
            .selectAll(".state-percentage")
            .data(sortedStates)
            .enter()
            .append("text")
            .attr("class", "state-percentage")
            .attr(
              "x",
              (d, i) => padding + (i % cols) * cellWidth + cellWidth / 2
            )
            .attr(
              "y",
              (d, i) =>
                padding +
                Math.floor(i / cols) * cellHeight +
                cellHeight / 2 +
                10
            )
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("fill", "white")
            .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.5)")
            .text((d) => {
              const approval =
                currentRound === 2 ? d.round2_approval : d.round1_approval;
              return approval.toFixed(1) + "%";
            });
        }

        function createStateRanking() {
          const svg = d3.select("#state-ranking");
          const container = svg.node().parentNode;
          const containerWidth = container.clientWidth - 40;
          const margin = getMobileMargins();
          const width = Math.max(
            200,
            containerWidth - margin.left - margin.right
          );
          const chartHeight = getMobileHeight();
          const height = chartHeight - margin.top - margin.bottom;

          svg.attr("width", containerWidth).attr("height", chartHeight);
          svg.selectAll("*").remove();

          const g = svg
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

          const sortedStates = [...statesData].sort(
            (a, b) => b.round2_approval - a.round2_approval
          );

          // Scales
          const x = d3.scaleLinear().domain([0, 100]).range([0, width]);

          const y = d3
            .scaleBand()
            .domain(sortedStates.map((d) => d.name))
            .range([0, height])
            .padding(0.1);

          // Axes
          g.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x).tickFormat((d) => d + "%"));

          g.append("g").attr("class", "axis").call(d3.axisLeft(y));

          // Bars
          g.selectAll(".ranking-bar")
            .data(sortedStates)
            .enter()
            .append("rect")
            .attr("class", "ranking-bar")
            .attr("x", 0)
            .attr("y", (d) => y(d.name))
            .attr("width", 0)
            .attr("height", y.bandwidth())
            .attr("fill", (d) => getStateColor(d.round2_approval))
            .attr("rx", 3)
            .on("mouseover", function (event, d) {
              const tooltip = d3.select("#tooltip");
              tooltip
                .style("opacity", 1)
                .html(
                  `
                                <strong>${d.name}</strong><br/>
                                Aprova√ß√£o: ${d.round2_approval.toFixed(1)}%<br/>
                                Deputados: ${d.round2_sim}/${
                    d.round2_total
                  }<br/>
                                Regi√£o: ${d.region}
                            `
                )
                .style("left", event.pageX + 10 + "px")
                .style("top", event.pageY - 10 + "px");
            })
            .on("mouseout", function () {
              d3.select("#tooltip").style("opacity", 0);
            })
            .transition()
            .duration(1000)
            .delay((d, i) => i * 30)
            .attr("width", (d) => x(d.round2_approval));

          // Add percentage labels
          g.selectAll(".ranking-label")
            .data(sortedStates)
            .enter()
            .append("text")
            .attr("class", "ranking-label")
            .attr("x", (d) => x(d.round2_approval) + 5)
            .attr("y", (d) => y(d.name) + y.bandwidth() / 2)
            .attr("dy", "0.35em")
            .style("font-size", "11px")
            .style("fill", "#1e293b")
            .style("font-weight", "500")
            .style("opacity", 0)
            .text((d) => d.round2_approval.toFixed(1) + "%")
            .transition()
            .duration(1000)
            .delay((d, i) => i * 30 + 500)
            .style("opacity", 1);

          // Add region labels
          g.selectAll(".region-label")
            .data(sortedStates)
            .enter()
            .append("text")
            .attr("class", "region-label")
            .attr("x", width + 10)
            .attr("y", (d) => y(d.name) + y.bandwidth() / 2)
            .attr("dy", "0.35em")
            .style("font-size", "10px")
            .style("fill", "#64748b")
            .text((d) => d.region);
        }

        function createRegionAnalysis() {
          const container = d3.select("#region-analysis");

          // Group states by region
          const regionGroups = d3.group(statesData, (d) => d.region);

          const regionData = Array.from(regionGroups)
            .map(([region, states]) => {
              const totalStates = states.length;
              const avgApproval = d3.mean(states, (d) => d.round2_approval);
              const bestState = states.reduce((a, b) =>
                a.round2_approval > b.round2_approval ? a : b
              );
              const worstState = states.reduce((a, b) =>
                a.round2_approval < b.round2_approval ? a : b
              );

              return {
                region,
                states,
                totalStates,
                avgApproval,
                bestState,
                worstState,
              };
            })
            .sort((a, b) => b.avgApproval - a.avgApproval);

          container
            .selectAll(".region-card")
            .data(regionData)
            .enter()
            .append("div")
            .attr("class", "region-card")
            .html(
              (d) => `
                        <div class="region-title">${d.region}</div>
                        <div class="region-stats">
                            <div class="region-stat">
                                <div class="region-stat-number">${
                                  d.totalStates
                                }</div>
                                <div class="region-stat-label">Estados</div>
                            </div>
                            <div class="region-stat">
                                <div class="region-stat-number">${d.avgApproval.toFixed(
                                  1
                                )}%</div>
                                <div class="region-stat-label">Aprova√ß√£o M√©dia</div>
                            </div>
                        </div>
                        <div class="state-list">
                            <strong>Maior aprova√ß√£o:</strong> ${
                              d.bestState.name
                            } (${d.bestState.round2_approval.toFixed(1)}%)<br/>
                            <strong>Menor aprova√ß√£o:</strong> ${
                              d.worstState.name
                            } (${d.worstState.round2_approval.toFixed(1)}%)<br/>
                            <strong>Estados:</strong> ${d.states
                              .map((s) => s.code)
                              .sort()
                              .join(", ")}
                        </div>
                    `
            );
        }

        function createComparisonChart() {
          const svg = d3.select("#comparison-chart");
          svg.selectAll("*").remove(); // Clear existing chart

          const container = svg.node().parentNode;
          const containerWidth = container.clientWidth - 40;
          const margin = isMobile()
            ? { top: 20, right: 25, bottom: 90, left: 70 }
            : { top: 20, right: 30, bottom: 60, left: 60 };
          const width = Math.max(
            250,
            containerWidth - margin.left - margin.right
          );
          const chartHeight = isMobile() ? 450 : 400;
          const height = chartHeight - margin.top - margin.bottom;

          svg.attr("width", containerWidth).attr("height", chartHeight);

          const g = svg
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

          // Scales
          const x = d3.scaleLinear().domain([0, 100]).range([0, width]);

          const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);

          const radius = d3
            .scaleSqrt()
            .domain([0, d3.max(statesData, (d) => d.round2_total)])
            .range(isMobile() ? [8, 25] : [3, 15]);

          // Axes with mobile-optimized tick count
          const xTicks = isMobile() ? 5 : 10;
          const yTicks = isMobile() ? 5 : 10;

          g.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0,${height})`)
            .call(
              d3
                .axisBottom(x)
                .ticks(xTicks)
                .tickFormat((d) => d + "%")
            )
            .selectAll("text")
            .style("font-size", isMobile() ? "14px" : "12px");

          g.append("g")
            .attr("class", "axis")
            .call(
              d3
                .axisLeft(y)
                .ticks(yTicks)
                .tickFormat((d) => d + "%")
            )
            .selectAll("text")
            .style("font-size", isMobile() ? "14px" : "12px");

          // Axis labels - adapt based on current round and mobile
          const labelFontSize = isMobile() ? "16px" : "14px";
          const labelOffset = isMobile() ? 60 : 40;

          if (currentRound === 1) {
            g.append("text")
              .attr("class", "axis-label")
              .attr(
                "transform",
                `translate(${width / 2},${height + labelOffset})`
              )
              .style("text-anchor", "middle")
              .style("font-size", labelFontSize)
              .style("font-weight", "600")
              .text(
                isMobile() ? "Estados" : "Estados (ordenados alfabeticamente)"
              );

            g.append("text")
              .attr("class", "axis-label")
              .attr("transform", "rotate(-90)")
              .attr("y", isMobile() ? -55 : -40)
              .attr("x", -height / 2)
              .style("text-anchor", "middle")
              .style("font-size", labelFontSize)
              .style("font-weight", "600")
              .text(isMobile() ? "1¬∫ Turno (%)" : "1¬∫ Turno - Aprova√ß√£o (%)");
          } else {
            g.append("text")
              .attr("class", "axis-label")
              .attr(
                "transform",
                `translate(${width / 2},${height + labelOffset})`
              )
              .style("text-anchor", "middle")
              .style("font-size", labelFontSize)
              .style("font-weight", "600")
              .text("1¬∫ Turno (%)");

            g.append("text")
              .attr("class", "axis-label")
              .attr("transform", "rotate(-90)")
              .attr("y", isMobile() ? -55 : -40)
              .attr("x", -height / 2)
              .style("text-anchor", "middle")
              .style("font-size", labelFontSize)
              .style("font-weight", "600")
              .text("2¬∫ Turno (%)");
          }

          // Diagonal line (only for comparison mode)
          if (currentRound === 2) {
            g.append("line")
              .attr("x1", 0)
              .attr("y1", height)
              .attr("x2", width)
              .attr("y2", 0)
              .attr("stroke", "#94a3b8")
              .attr("stroke-dasharray", "5,5")
              .attr("opacity", 0.5);
          }

          // Circles - adapt positioning based on current round
          if (currentRound === 1) {
            // Show horizontal scatter plot for round 1 only
            const xBand = d3
              .scaleBand()
              .domain(statesData.map((d) => d.code))
              .range([0, width])
              .padding(0.1);

            g.selectAll(".comparison-circle")
              .data(statesData.filter((d) => d.round1_total > 0))
              .enter()
              .append("circle")
              .attr("class", "comparison-circle")
              .attr("cx", (d) => xBand(d.code) + xBand.bandwidth() / 2)
              .attr("cy", (d) => y(d.round1_approval))
              .attr("r", 0)
              .attr("fill", (d) => getStateColor(d.round1_approval))
              .attr("opacity", 0.7)
              .style("cursor", "pointer");
          } else {
            // Show comparison scatter plot for round 1 vs round 2
            g.selectAll(".comparison-circle")
              .data(
                statesData.filter(
                  (d) => d.round1_total > 0 && d.round2_total > 0
                )
              )
              .enter()
              .append("circle")
              .attr("class", "comparison-circle")
              .attr("cx", (d) => x(d.round1_approval))
              .attr("cy", (d) => y(d.round2_approval))
              .attr("r", 0)
              .attr("fill", (d) => getStateColor(d.round2_approval))
              .attr("opacity", 0.7)
              .style("cursor", "pointer");
          }

          // Add event handlers and transitions
          g.selectAll(".comparison-circle")
            .on("mouseover", function (event, d) {
              const tooltip = d3.select("#tooltip");
              if (currentRound === 1) {
                tooltip.style("opacity", 1).html(`
                                    <strong>${d.name}</strong><br/>
                                    C√≥digo: ${d.code}<br/>
                                    1¬∫ Turno: ${d.round1_approval.toFixed(
                                      1
                                    )}%<br/>
                                    Deputados: ${d.round1_sim}/${
                  d.round1_total
                }<br/>
                                    Regi√£o: ${d.region}
                                `);
              } else {
                const change = d.round2_approval - d.round1_approval;
                tooltip.style("opacity", 1).html(`
                                    <strong>${d.name}</strong><br/>
                                    1¬∫ Turno: ${d.round1_approval.toFixed(
                                      1
                                    )}%<br/>
                                    2¬∫ Turno: ${d.round2_approval.toFixed(
                                      1
                                    )}%<br/>
                                    Mudan√ßa: ${
                                      change > 0 ? "+" : ""
                                    }${change.toFixed(1)}pp
                                `);
              }
              tooltip
                .style("left", event.pageX + 10 + "px")
                .style("top", event.pageY - 10 + "px");
            })
            .on("mouseout", function () {
              d3.select("#tooltip").style("opacity", 0);
            })
            .transition()
            .duration(1000)
            .delay((d, i) => i * 100)
            .attr("r", (d) =>
              radius(currentRound === 1 ? d.round1_total : d.round2_total)
            );

          // Add state labels for notable changes
          const notableStates = statesData.filter(
            (d) =>
              Math.abs(d.round2_approval - d.round1_approval) > 5 ||
              d.round2_approval === 100 ||
              d.round2_approval < 60
          );

          g.selectAll(".state-label-comparison")
            .data(notableStates)
            .enter()
            .append("text")
            .attr("class", "state-label-comparison")
            .attr("x", (d) => x(d.round1_approval) + radius(d.round2_total) + 3)
            .attr("y", (d) => y(d.round2_approval))
            .attr("dy", "0.35em")
            .style("font-size", "10px")
            .style("fill", "#1e293b")
            .style("font-weight", "500")
            .text((d) => d.code);
        }

        // Initialize charts
        updateMap();
        createStateRanking();
        createRegionAnalysis();
        createComparisonChart();

        // Make showRound function global
        window.showRound = showRound;

        // Update stats
        document.getElementById("total-states").textContent = statesData.length;
        document.getElementById("unanimous-states").textContent =
          statesData.filter((s) => s.round2_approval === 100).length;
        document.getElementById("divided-states").textContent =
          statesData.filter((s) => s.round2_approval <= 60).length;
        document.getElementById("avg-approval").textContent =
          Math.round(d3.mean(statesData, (d) => d.round2_approval)) + "%";
      }

      // Initialize when page loads
      loadData();

      // Responsive resize
      window.addEventListener("resize", function () {
        // Reload charts on resize
        location.reload();
      });
    </script>
    <div
      class="footer"
      style="
        background: rgba(30, 41, 59, 0.95);
        color: white;
        padding: 2rem;
        margin-top: 3rem;
        text-align: center;
      ">
      <div class="footer-content" style="max-width: 1200px; margin: 0 auto">
        <div
          id="version-info"
          style="
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
          ">
          <!-- Version info will be injected here by version.js -->
        </div>
        <p style="margin-top: 1rem; font-size: 0.9rem; color: #94a3b8">
          <a href="index.html" style="color: #3b82f6; text-decoration: none"
            >‚Üê Voltar ao in√≠cio</a
          >
          | Criado por
          <a
            href="https://github.com/fcavalcantirj"
            style="color: #3b82f6; text-decoration: none"
            >fcavalcantirj</a
          >
        </p>
      </div>
    </div>

    <script src="version.js"></script>
  </body>
</html>
