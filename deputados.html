<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Busca de Deputados - PEC da Bandidagem | 488 Deputados Federais
    </title>
    <meta
      name="description"
      content="Busque e filtre os 488 deputados que votaram na PEC da Bandidagem. Veja quem votou SIM (341), NÃO (131) ou mudou de voto. Filtros por partido e estado disponíveis." />
    <meta
      name="keywords"
      content="busca deputados, PEC da Bandidagem, lista deputados, voto SIM, voto NÃO, filtro por partido" />
    <meta
      property="og:title"
      content="Busca de Deputados - PEC da Bandidagem" />
    <meta
      property="og:description"
      content="Encontre e analise individualmente os deputados que votaram na PEC da Bandidagem. Filtros avançados por voto, partido e estado." />
    <meta
      property="og:url"
      content="https://pec-bandidagem.vercel.app/deputados.html" />
    <link
      rel="canonical"
      href="https://pec-bandidagem.vercel.app/deputados.html" />

    <!-- Resource preloading for performance -->
    <link rel="preload" href="data.js" as="script" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-P47CK1TDL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-P47CK1TDL8", {
        send_page_view: true,
        page_title: "PEC da Bandidagem - Deputados Individuais",
        content_group1: "Deputy Analysis",
        content_group2: "Political Analysis",
      });
    </script>

    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="analytics.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body class="deputados">
    <!-- GitHub Fork Ribbon -->
    <a
      class="github-fork-ribbon"
      href="https://github.com/fcavalcantirj/pec-bandidagem"
      data-ribbon="Fork me on GitHub"
      title="Fork me on GitHub"
      >Fork me on GitHub</a
    >

    <div class="header">
      <h1>👥 PEC da Bandidagem</h1>
      <p>Busca e Análise Individual de Deputados</p>

      <nav class="nav">
        <a href="index.html">🏠 Início</a>
        <a href="deputados.html" class="active">👥 Deputados</a>
        <a href="partidos.html">🎯 Partidos</a>
        <a href="estados.html">🗺️ Estados</a>
        <a href="fluxo.html">🔄 Fluxo</a>
        <a href="relatorio.html">📋 Relatório</a>
        <a href="despesas.html">💰 Despesas</a>
      </nav>
    </div>

    <div class="container">
      <div class="search-section">
        <h2 style="text-align: center; margin-bottom: 1.5rem; color: #0f172a">
          🔍 Buscar Deputados
        </h2>

        <div class="search-container">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Digite o nome do deputado..." />
          <select id="partyFilter" class="filter-select">
            <option value="">Todos os Partidos</option>
          </select>
          <select id="stateFilter" class="filter-select">
            <option value="">Todos os Estados</option>
          </select>
        </div>

        <div class="vote-filters">
          <h3
            style="
              text-align: center;
              margin-bottom: 1rem;
              color: #1a202c;
              font-size: 1.1rem;
              font-weight: 700;
            ">
            Filtrar por Voto:
          </h3>
          <div class="filter-buttons">
            <button id="filterAll" class="filter-btn active">
              📊 Todos (488)
            </button>
            <button id="filterSim" class="filter-btn filter-sim">
              🚨 Votaram SIM (341)
            </button>
            <button id="filterNao" class="filter-btn filter-nao">
              ✅ Votaram NÃO (131)
            </button>
            <button id="filterChanged" class="filter-btn filter-changed">
              🔄 Mudaram Voto (3)
            </button>
          </div>
        </div>

        <div class="stats-summary" id="searchStats">
          <div class="stat-card">
            <div class="stat-number" id="totalCount">-</div>
            <div class="stat-label">Total Encontrado</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="simCount">-</div>
            <div class="stat-label">Votaram SIM</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="naoCount">-</div>
            <div class="stat-label">Votaram NÃO</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="changedCount">-</div>
            <div class="stat-label">Mudaram Voto</div>
          </div>
        </div>
      </div>

      <div class="deputies-grid" id="deputiesGrid">
        <!-- Deputies will be populated here -->
      </div>

      <div class="no-results" id="noResults" style="display: none">
        🔍 Nenhum deputado encontrado com os critérios selecionados.
      </div>

      <button class="load-more" id="loadMore" style="display: none">
        Carregar Mais Deputados
      </button>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div
      class="footer"
      style="
        background: rgba(30, 41, 59, 0.95);
        color: white;
        padding: 2rem;
        margin-top: 3rem;
        text-align: center;
      ">
      <div class="footer-content" style="max-width: 1200px; margin: 0 auto">
        <div
          id="version-info"
          style="
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
          ">
          <!-- Version info will be injected here by version.js -->
        </div>
        <p style="margin-top: 1rem; font-size: 0.9rem; color: #94a3b8">
          <a href="index.html" style="color: #3b82f6; text-decoration: none"
            >← Voltar ao início</a
          >
          | Criado por
          <a
            href="https://github.com/fcavalcantirj"
            style="color: #3b82f6; text-decoration: none"
            >fcavalcantirj</a
          >
        </p>
      </div>
    </div>

    <script src="data.js"></script>
    <script src="version.js"></script>
    <script>
      let allDeputies = [];
      let filteredDeputies = [];
      let currentPage = 0;
      const itemsPerPage = 50;

      // Load and process deputy data
      function loadDeputyData() {
        if (typeof VISUALIZATION_DATA !== "undefined") {
          console.log("Loading deputy data...");

          // Combine data from both rounds
          const round1Data = VISUALIZATION_DATA.round1 || [];
          const round2Data = VISUALIZATION_DATA.round2 || [];

          // Create a map for round 2 data
          const round2Map = new Map();
          round2Data.forEach((deputy) => {
            round2Map.set(deputy.deputado, deputy);
          });

          // Process all deputies
          allDeputies = round1Data.map((deputy1) => {
            const deputy2 = round2Map.get(deputy1.deputado);

            return {
              name: deputy1.deputado,
              party: deputy1.partido,
              state: deputy1.estado,
              round1_vote: deputy1.voto,
              round2_vote: deputy2 ? deputy2.voto : "Ausente",
              secret_defense: deputy2 ? deputy2.voto_secreto : "Não informado",
              changed_vote:
                deputy1.voto !== (deputy2 ? deputy2.voto : deputy1.voto),
              consistency:
                deputy1.voto === (deputy2 ? deputy2.voto : deputy1.voto)
                  ? "Consistente"
                  : "Mudou",
            };
          });

          console.log(`Loaded ${allDeputies.length} deputies`);

          setupFilters();
          filterDeputies();
          trackVisualizationInteraction(
            "deputy_search",
            "data_loaded",
            `${allDeputies.length} deputies`
          );
        } else {
          console.error("Deputy data not found");
        }
      }

      // Setup filter options
      function setupFilters() {
        const parties = [...new Set(allDeputies.map((d) => d.party))].sort();
        const states = [...new Set(allDeputies.map((d) => d.state))].sort();

        const partySelect = document.getElementById("partyFilter");
        const stateSelect = document.getElementById("stateFilter");

        parties.forEach((party) => {
          const option = document.createElement("option");
          option.value = party;
          option.textContent = party;
          partySelect.appendChild(option);
        });

        states.forEach((state) => {
          const option = document.createElement("option");
          option.value = state;
          option.textContent = state;
          stateSelect.appendChild(option);
        });
      }

      // Filter deputies based on search and filters
      function filterDeputies() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const partyFilter = document.getElementById("partyFilter").value;
        const stateFilter = document.getElementById("stateFilter").value;

        filteredDeputies = allDeputies.filter((deputy) => {
          const matchesSearch = deputy.name.toLowerCase().includes(searchTerm);
          const matchesParty = !partyFilter || deputy.party === partyFilter;
          const matchesState = !stateFilter || deputy.state === stateFilter;

          // Vote filtering based on active filter button
          const matchesVoteFilter = checkVoteFilter(deputy);

          return (
            matchesSearch && matchesParty && matchesState && matchesVoteFilter
          );
        });

        currentPage = 0;
        updateStats();
        renderDeputies();

        // Track search if there's a search term
        if (searchTerm) {
          trackVisualizationInteraction(
            "deputy_search",
            "search_performed",
            searchTerm
          );
        }
      }

      // Update statistics
      function updateStats() {
        const total = filteredDeputies.length;
        const simCount = filteredDeputies.filter(
          (d) => d.round2_vote === "Sim"
        ).length;
        const naoCount = filteredDeputies.filter(
          (d) => d.round2_vote === "Não"
        ).length;
        const changedCount = filteredDeputies.filter(
          (d) => d.changed_vote
        ).length;

        document.getElementById("totalCount").textContent = total;
        document.getElementById("simCount").textContent = simCount;
        document.getElementById("naoCount").textContent = naoCount;
        document.getElementById("changedCount").textContent = changedCount;
      }

      // Render deputies grid
      function renderDeputies() {
        const grid = document.getElementById("deputiesGrid");
        const noResults = document.getElementById("noResults");
        const loadMore = document.getElementById("loadMore");

        if (filteredDeputies.length === 0) {
          grid.innerHTML = "";
          noResults.style.display = "block";
          loadMore.style.display = "none";
          return;
        }

        noResults.style.display = "none";

        const endIndex = Math.min(
          (currentPage + 1) * itemsPerPage,
          filteredDeputies.length
        );
        const deputiesToShow = filteredDeputies.slice(0, endIndex);

        grid.innerHTML = deputiesToShow
          .map((deputy) => createDeputyCard(deputy))
          .join("");

        // Show/hide load more button
        if (endIndex < filteredDeputies.length) {
          loadMore.style.display = "block";
        } else {
          loadMore.style.display = "none";
        }
      }

      // Create deputy card HTML
      function createDeputyCard(deputy) {
        const getVoteBadge = (vote) => {
          const classes = {
            Sim: "vote-sim",
            Não: "vote-nao",
            Abstenção: "vote-abstencao",
            Ausente: "vote-ausente",
          };
          return `<span class="vote-badge ${
            classes[vote] || "vote-ausente"
          }">${vote}</span>`;
        };

        const getSecretVoteIndicator = (defense) => {
          if (defense === "Sim") {
            return '<div class="secret-vote-indicator defended-secret">🔐 Defendeu voto secreto</div>';
          } else if (defense === "Não") {
            return '<div class="secret-vote-indicator opposed-secret">🔓 Contra voto secreto</div>';
          }
          return "";
        };

        const getConsistencyIndicator = (consistency) => {
          if (consistency === "Consistente") {
            return '<span class="consistency-indicator consistent">✓ Consistente</span>';
          } else {
            return '<span class="consistency-indicator changed">⚠ Mudou voto</span>';
          }
        };

        return `
                <div class="deputy-card" onclick="showDeputyDetails('${
                  deputy.name
                }')">
                    <div class="deputy-name">${deputy.name}</div>
                    <div class="deputy-info">
                        <span class="party-state">${deputy.party} - ${
          deputy.state
        }</span>
                        ${getConsistencyIndicator(deputy.consistency)}
                    </div>
                    <div class="voting-badges">
                        <span style="font-size: 0.8rem; color: #64748b;">1º Turno:</span>
                        ${getVoteBadge(deputy.round1_vote)}
                        <span style="font-size: 0.8rem; color: #64748b; margin-left: 0.5rem;">2º Turno:</span>
                        ${getVoteBadge(deputy.round2_vote)}
                    </div>
                    <div class="deputy-details">
                        <div>Padrão de votação: ${deputy.round1_vote} → ${
          deputy.round2_vote
        }</div>
                        ${getSecretVoteIndicator(deputy.secret_defense)}
                    </div>
                </div>
            `;
      }

      // Show deputy details (could be expanded to modal)
      async function showDeputyDetails(deputyName) {
        const deputy = allDeputies.find((d) => d.name === deputyName);
        if (deputy) {
          // Track deputy click with consistent naming across pages
          trackVisualizationInteraction(
            "deputy_search",
            "deputy_selected",
            deputyName
          );

          // Also track with same event name as despesas page for consistency
          if (typeof gtag !== "undefined") {
            gtag("event", "deputy_click", {
              event_category: "deputados_interaction",
              event_label: deputyName,
              page_type: "deputados",
            });
          }

          // First search for the deputy by name to get their ID
          let deputyDetails = null;
          try {
            // Use proxy for Vercel deployment, direct API for local development
            const isLocal =
              window.location.hostname === "localhost" ||
              window.location.hostname === "127.0.0.1";
            const apiBase = isLocal
              ? "https://dadosabertos.camara.leg.br/api/v2"
              : "/api/proxy?endpoint=";

            const searchUrl = isLocal
              ? `${apiBase}/deputados?nome=${encodeURIComponent(
                  deputyName
                )}&ordem=ASC&ordenarPor=nome`
              : `${apiBase}deputados?nome=${encodeURIComponent(
                  deputyName
                )}&ordem=ASC&ordenarPor=nome`;

            const searchResponse = await fetch(searchUrl);
            if (searchResponse.ok) {
              const searchData = await searchResponse.json();

              if (searchData.dados && searchData.dados.length > 0) {
                const deputyInfo = searchData.dados[0]; // Take the first match

                // Now get their detailed info
                const detailUrl = isLocal
                  ? `${apiBase}/deputados/${deputyInfo.id}`
                  : `${apiBase}deputados/${deputyInfo.id}`;

                const detailResponse = await fetch(detailUrl);
                if (detailResponse.ok) {
                  const detailData = await detailResponse.json();
                  deputyDetails = detailData.dados;
                  deputyDetails.id = deputyInfo.id; // Add the ID for consistency
                }
              }
            }
          } catch (error) {
            console.log("Error fetching deputy details:", error);
          }

          showDeputyModal(deputy, deputyDetails);
        }
      }

      function showDeputyModal(deputy, details) {
        // Remove existing modal if any
        const existingModal = document.getElementById("deputyModal");
        if (existingModal) {
          existingModal.remove();
        }

        const isProPEC = deputy.round2_vote === "Sim";

        // Create modal HTML
        const modalHTML = `
                <div id="deputyModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${deputy.name}</h2>
                            <button class="modal-close" onclick="closeDeputyModal()">&times;</button>
                        </div>

                        <div class="modal-body">
                            <div class="deputy-main-info">
                                <div class="deputy-photo-section">
                                    <img src="${
                                      details && details.id
                                        ? `https://www.camara.leg.br/internet/deputado/bandep/${details.id}.jpg`
                                        : ""
                                    }"
                                         alt="${
                                           deputy.name
                                         }" class="deputy-modal-photo"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                                    <div class="deputy-photo-fallback" style="display: none; width: 150px; height: 180px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; align-items: center; justify-content: center; color: white; font-size: 3rem; font-weight: bold;">
                                        ${deputy.name.charAt(0)}
                                    </div>
                                </div>

                                <div class="deputy-info-section">
                                    ${
                                      details
                                        ? `
                                    <p><strong>Nome Civil:</strong> ${
                                      details.nomeCivil || deputy.name
                                    }</p>
                                    <p><strong>Nome Eleitoral:</strong> ${
                                      details.ultimoStatus?.nomeEleitoral ||
                                      deputy.name
                                    }</p>
                                    `
                                        : ""
                                    }
                                    <p><strong>Partido:</strong> ${
                                      deputy.party
                                    }</p>
                                    <p><strong>UF:</strong> ${deputy.state}</p>
                                    <p><strong>1º Turno:</strong> <span class="vote-badge ${
                                      deputy.round1_vote === "Sim"
                                        ? "vote-sim"
                                        : "vote-nao"
                                    }">${deputy.round1_vote}</span></p>
                                    <p><strong>2º Turno:</strong> <span class="vote-badge ${
                                      deputy.round2_vote === "Sim"
                                        ? "vote-sim"
                                        : "vote-nao"
                                    }">${deputy.round2_vote}</span></p>
                                </div>
                            </div>

                            ${
                              isProPEC
                                ? `
                            <div class="contact-action-section">
                                <div class="action-banner">
                                    🏴 Faça seu protesto por email ou nas redes sociais!
                                </div>

                                <div class="contact-info">
                                    ${
                                      details?.ultimoStatus?.gabinete?.email
                                        ? `
                                    <a href="mailto:${details.ultimoStatus.gabinete.email}" class="contact-email">
                                        ${details.ultimoStatus.gabinete.email}
                                    </a>
                                    `
                                        : '<span class="no-contact">Email não informado</span>'
                                    }
                                </div>

                                <div class="message-templates">
                                    <div class="template-section">
                                        <h4>📱 Texto para Redes Sociais</h4>
                                        <textarea id="socialText" readonly>Prezado ${
                                          deputy.name
                                        }, seu voto na PEC 3/21 (PEC da blindagem) envergonha eleitores. Ela cria políticos intocáveis e destrói a democracia brasileira. Reconsidere sua posição!</textarea>
                                        <button onclick="copyToClipboard('socialText')" class="copy-btn">📋 Copiar</button>
                                    </div>

                                    <div class="template-section">
                                        <h4>📧 Texto para Email</h4>
                                        <textarea id="emailText" readonly>Prezado ${
                                          deputy.name
                                        },\n\nAcompanhei seu voto referente a PEC 3 de 2021, também conhecida como "PEC da Blindagem". Como eleitor do seu estado, gostaria de expressar minha preocupação com essa decisão que pode comprometer a transparência e accountability de nossos representantes.\n\nAtenciosamente,\n[Seu nome]</textarea>
                                        <button onclick="copyToClipboard('emailText')" class="copy-btn">📋 Copiar</button>
                                    </div>
                                </div>
                            </div>
                            `
                                : `
                            <div class="appreciation-section">
                                <div class="appreciation-banner">
                                    👏 Apoie este deputado por defender a transparência!
                                </div>

                                <div class="contact-info">
                                    ${
                                      details?.ultimoStatus?.gabinete?.email
                                        ? `
                                    <a href="mailto:${details.ultimoStatus.gabinete.email}" class="contact-email">
                                        ${details.ultimoStatus.gabinete.email}
                                    </a>
                                    `
                                        : '<span class="no-contact">Email não informado</span>'
                                    }
                                </div>

                                <div class="message-templates">
                                    <div class="template-section">
                                        <h4>📱 Texto para Redes Sociais</h4>
                                        <textarea id="socialText" readonly>Parabéns ${
                                          deputy.name
                                        } por votar CONTRA a PEC da Blindagem! Obrigado por defender a transparência e a democracia brasileira. Continue representando bem nossos interesses! 👏</textarea>
                                        <button onclick="copyToClipboard('socialText')" class="copy-btn">📋 Copiar</button>
                                    </div>

                                    <div class="template-section">
                                        <h4>📧 Texto para Email</h4>
                                        <textarea id="emailText" readonly>Prezado ${
                                          deputy.name
                                        },\n\nGostaria de parabenizá-lo por seu voto CONTRA a PEC 3 de 2021. Sua posição em defesa da transparência e accountability democrática é fundamental para nossa democracia.\n\nContinue representando bem os interesses do povo!\n\nAtenciosamente,\n[Seu nome]</textarea>
                                        <button onclick="copyToClipboard('emailText')" class="copy-btn">📋 Copiar</button>
                                    </div>
                                </div>
                            </div>
                            `
                            }

                            ${
                              details
                                ? `
                            <div class="additional-info">
                                <div class="info-grid">
                                    <div class="info-section">
                                        <h4>👤 Informações Pessoais</h4>
                                        ${
                                          details.sexo
                                            ? `<p><strong>Sexo:</strong> ${
                                                details.sexo === "M"
                                                  ? "Masculino"
                                                  : "Feminino"
                                              }</p>`
                                            : ""
                                        }
                                        ${
                                          details.dataNascimento
                                            ? `<p><strong>Data de Nascimento:</strong> ${new Date(
                                                details.dataNascimento
                                              ).toLocaleDateString(
                                                "pt-BR"
                                              )}</p>`
                                            : ""
                                        }
                                        ${
                                          details.municipioNascimento &&
                                          details.ufNascimento
                                            ? `<p><strong>Local de Nascimento:</strong> ${details.municipioNascimento} - ${details.ufNascimento}</p>`
                                            : ""
                                        }
                                        ${
                                          details.escolaridade
                                            ? `<p><strong>Escolaridade:</strong> ${details.escolaridade}</p>`
                                            : ""
                                        }
                                        ${
                                          details.ultimoStatus?.situacao
                                            ? `<p><strong>Situação:</strong> ${details.ultimoStatus.situacao}</p>`
                                            : ""
                                        }
                                        ${
                                          details.ultimoStatus
                                            ?.condicaoEleitoral
                                            ? `<p><strong>Condição Eleitoral:</strong> ${details.ultimoStatus.condicaoEleitoral}</p>`
                                            : ""
                                        }
                                    </div>

                                    ${
                                      details.ultimoStatus?.gabinete
                                        ? `
                                    <div class="info-section">
                                        <h4>🏛️ Gabinete</h4>
                                        ${
                                          details.ultimoStatus.gabinete.sala
                                            ? `<p><strong>Sala:</strong> ${details.ultimoStatus.gabinete.sala}</p>`
                                            : ""
                                        }
                                        ${
                                          details.ultimoStatus.gabinete.predio
                                            ? `<p><strong>Prédio:</strong> ${details.ultimoStatus.gabinete.predio}</p>`
                                            : ""
                                        }
                                        ${
                                          details.ultimoStatus.gabinete.andar
                                            ? `<p><strong>Andar:</strong> ${details.ultimoStatus.gabinete.andar}</p>`
                                            : ""
                                        }
                                        ${
                                          details.ultimoStatus.gabinete.telefone
                                            ? `<p><strong>Telefone:</strong> ${details.ultimoStatus.gabinete.telefone}</p>`
                                            : ""
                                        }
                                    </div>
                                    `
                                        : ""
                                    }
                                </div>
                            </div>
                            `
                                : ""
                            }
                        </div>
                    </div>
                </div>
            `;

        // Add modal to page
        document.body.insertAdjacentHTML("beforeend", modalHTML);

        // Add event listeners
        const modal = document.getElementById("deputyModal");

        // Close modal when clicking outside
        modal.addEventListener("click", function (e) {
          if (e.target === modal) {
            closeDeputyModal();
          }
        });

        // Close modal with Escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeDeputyModal();
          }
        });
      }

      function closeDeputyModal() {
        const modal = document.getElementById("deputyModal");
        if (modal) {
          modal.remove();
        }
      }

      function copyToClipboard(textareaId) {
        const textarea = document.getElementById(textareaId);
        textarea.select();
        textarea.setSelectionRange(0, 99999); // For mobile devices

        try {
          document.execCommand("copy");

          // Show feedback
          const button = textarea.nextElementSibling;
          const originalText = button.textContent;
          button.textContent = "✅ Copiado!";
          button.style.background = "#10b981";

          setTimeout(() => {
            button.textContent = originalText;
            button.style.background = "";
          }, 2000);

          trackVisualizationInteraction(
            "deputy_modal",
            "text_copied",
            textareaId
          );
        } catch (err) {
          console.error("Failed to copy text: ", err);
        }
      }

      // Vote filter functionality
      let currentVoteFilter = "all"; // 'all', 'sim', 'nao', 'changed'

      function checkVoteFilter(deputy) {
        switch (currentVoteFilter) {
          case "all":
            return true;
          case "sim":
            return deputy.round2_vote === "Sim";
          case "nao":
            return deputy.round2_vote === "Não";
          case "changed":
            return deputy.round1_vote !== deputy.round2_vote;
          default:
            return true;
        }
      }

      function setVoteFilter(filter) {
        currentVoteFilter = filter;

        // Update button states
        document
          .querySelectorAll(".filter-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document
          .getElementById(
            `filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`
          )
          .classList.add("active");

        // Apply filter
        filterDeputies();

        // Track filter usage
        trackVisualizationInteraction("deputy_search", "vote_filter", filter);
      }

      // Event listeners
      document
        .getElementById("searchInput")
        .addEventListener("input", filterDeputies);
      document
        .getElementById("partyFilter")
        .addEventListener("change", filterDeputies);
      document
        .getElementById("stateFilter")
        .addEventListener("change", filterDeputies);

      // Vote filter button listeners
      document
        .getElementById("filterAll")
        .addEventListener("click", () => setVoteFilter("all"));
      document
        .getElementById("filterSim")
        .addEventListener("click", () => setVoteFilter("sim"));
      document
        .getElementById("filterNao")
        .addEventListener("click", () => setVoteFilter("nao"));
      document
        .getElementById("filterChanged")
        .addEventListener("click", () => setVoteFilter("changed"));

      document.getElementById("loadMore").addEventListener("click", () => {
        currentPage++;
        renderDeputies();
        trackVisualizationInteraction(
          "deputy_search",
          "load_more",
          `page_${currentPage}`
        );
      });

      // Analytics function (from analytics.js)
      function trackVisualizationInteraction(
        chartType,
        action,
        details,
        value = 1
      ) {
        if (typeof gtag !== "undefined") {
          gtag("event", "visualization_interaction", {
            chart_type: chartType,
            interaction_action: action,
            interaction_details: details,
            event_category: "Data Visualization",
            page_type: "Deputy Search",
          });
        }
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        loadDeputyData();
      });
    </script>
  </body>
</html>
