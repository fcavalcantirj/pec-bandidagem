<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEC da Bandidagem - Despesas dos Deputados</title>
    <meta name="description" content="An√°lise completa das despesas parlamentares dos deputados que votaram na PEC da Bandidagem. Transpar√™ncia total dos gastos p√∫blicos com dados oficiais da C√¢mara dos Deputados.">
    <meta name="keywords" content="despesas parlamentares, gastos deputados, transpar√™ncia, PEC bandidagem, cota parlamentar, gastos p√∫blicos">
    <meta property="og:title" content="Despesas dos Deputados - PEC da Bandidagem">
    <meta property="og:description" content="An√°lise completa das despesas parlamentares dos deputados que votaram na PEC da Bandidagem.">
    <meta property="og:url" content="https://pec-bandidagem.vercel.app/despesas.html">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P47CK1TDL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-P47CK1TDL8', {
        send_page_view: true,
        page_title: 'PEC da Bandidagem - Despesas dos Deputados',
        content_group1: 'Expense Analysis',
        content_group2: 'Political Analysis'
      });

      // Expense tracking functions
      function trackExpenseInteraction(action, details) {
        gtag('event', 'expense_interaction', {
          interaction_action: action,
          interaction_details: details,
          event_category: 'Expense Analysis',
          event_label: `Expense_${action}`,
          page_type: 'despesas'
        });
      }

      // Track page engagement
      let startTime = Date.now();
      window.addEventListener('beforeunload', function() {
        gtag('event', 'page_engagement', {
          time_spent: Math.round((Date.now() - startTime) / 1000),
          page_type: 'despesas',
          event_category: 'Content Performance'
        });
      });
    </script>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a202c;
            font-weight: 500;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            padding: 1.5rem 1rem;
            box-shadow: 0 8px 40px rgba(0,0,0,0.15);
            border-bottom: 4px solid #4f46e5;
            border-radius: 0 0 24px 24px;
            border-left: 1px solid rgba(255,255,255,0.8);
            border-right: 1px solid rgba(255,255,255,0.8);
        }

        .header h1 {
            font-size: 1.8rem;
            color: #0f172a;
            margin-bottom: 0.5rem;
            text-align: center;
            line-height: 1.2;
            font-weight: 800;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1rem;
            color: #334155;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        @media (min-width: 768px) {
            .header {
                padding: 2rem;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header p {
                font-size: 1.1rem;
            }
        }

        @media (min-width: 1024px) {
            .header h1 {
                font-size: 2.5rem;
            }

            .header p {
                font-size: 1.2rem;
            }
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .nav {
                gap: 1rem;
                flex-wrap: nowrap;
            }
        }

        .nav a {
            padding: 0.6rem 1rem;
            background: #4f46e5;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .nav a {
                padding: 0.75rem 1.5rem;
                border-radius: 25px;
                font-size: 1rem;
            }
        }

        .nav a:hover, .nav a.active {
            background: #3730a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }

        .container {
            width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                padding: 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1400px;
                padding: 2rem;
            }
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        @media (min-width: 768px) {
            .chart-container {
                padding: 2rem;
            }
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .chart-description {
            color: #64748b;
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        @media (min-width: 768px) {
            .chart-title {
                font-size: 1.8rem;
            }

            .chart-description {
                font-size: 1.1rem;
            }
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: #4f46e5;
            background: #4f46e5;
            color: white;
            transform: translateY(-1px);
        }

        .search-container {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .search-input {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .deputy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .deputy-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .deputy-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .deputy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .deputy-name {
            font-weight: 700;
            color: #0f172a;
            font-size: 1.1rem;
        }

        .deputy-party {
            background: #4f46e5;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .expense-total {
            font-size: 1.5rem;
            font-weight: 800;
            color: #dc2626;
            text-align: center;
            margin-bottom: 1rem;
        }

        .expense-details {
            font-size: 0.9rem;
            color: #64748b;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 1.1rem;
        }

        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            max-width: 400px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 0.5rem;
        }

        .loading-details {
            font-size: 0.9rem;
            color: #64748b;
            text-align: center;
            line-height: 1.5;
        }

        .error {
            text-align: center;
            padding: 2rem;
            color: #dc2626;
            font-size: 1.1rem;
            background: rgba(254, 226, 226, 0.8);
            border-radius: 12px;
            margin: 1rem 0;
        }

        .load-more-container {
            text-align: center;
            margin: 2rem 0;
        }

        .load-more-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .load-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }

        .load-more-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .stats-section {
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #4f46e5;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .expense-chart {
            width: 100%;
            height: 400px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            margin: 1rem 0;
        }

        .api-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #059669;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .api-badge::before {
            content: "üîó";
            font-size: 1rem;
        }

        /* GitHub fork ribbon - classic style */
        .github-fork-ribbon {
            width: 12.1em;
            height: 12.1em;
            position: fixed;
            overflow: hidden;
            top: 0;
            right: 0;
            z-index: 9999;
            pointer-events: none;
            font-size: 13px;
            text-decoration: none;
            text-indent: -999999px;
            opacity: 0.9;
        }

        .github-fork-ribbon:hover, .github-fork-ribbon:active {
            background-color: rgba(0, 0, 0, 0.0);
        }

        .github-fork-ribbon:before, .github-fork-ribbon:after {
            position: absolute;
            display: block;
            width: 15.38em;
            height: 1.54em;
            top: 3.23em;
            right: -3.23em;
            box-sizing: content-box;
            transform: rotate(45deg);
        }

        .github-fork-ribbon:before {
            content: "";
            padding: .38em 0;
            background-color: #a00;
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
            box-shadow: 0 .15em .23em 0 rgba(0, 0, 0, 0.5);
            pointer-events: auto;
        }

        .github-fork-ribbon:after {
            content: attr(data-ribbon);
            color: #fff;
            font: 700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;
            line-height: 1.54em;
            text-decoration: none;
            text-shadow: 0 -.08em rgba(0, 0, 0, 0.5);
            text-align: center;
            text-indent: 0;
            padding: .15em 0;
            margin: .15em 0;
            border-width: .08em 0;
            border-style: dotted;
            border-color: #fff;
            border-color: rgba(255, 255, 255, 0.7);
        }

        @media (max-width: 768px) {
            .github-fork-ribbon {
                font-size: 11px;
                opacity: 0.8;
            }
        }

        @media (max-width: 480px) {
            .github-fork-ribbon {
                font-size: 10px;
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <!-- GitHub Fork Ribbon -->
    <a class="github-fork-ribbon" href="https://github.com/fcavalcantirj/pec-bandidagem" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>

    <div class="header">
        <h1>üí∞ PEC da Bandidagem</h1>
        <p>An√°lise transparente dos gastos parlamentares relacionados √† PEC da Bandidagem</p>
        <div class="nav">
            <a href="index.html">üè† In√≠cio</a>
            <a href="deputados.html">üë• Deputados</a>
            <a href="partidos.html">üéØ Partidos</a>
            <a href="estados.html">üó∫Ô∏è Estados</a>
            <a href="fluxo.html">üîÑ Fluxo</a>
            <a href="relatorio.html">üìã Relat√≥rio</a>
            <a href="despesas.html" class="active">üí∞ Despesas</a>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Overview -->
        <div class="chart-container">
            <h2 class="chart-title">Resumo das Despesas</h2>
            <p class="chart-description">Estat√≠sticas gerais dos gastos parlamentares dos deputados analisados</p>

            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-expenses">-</div>
                    <div class="stat-label">Total Gasto</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-expense">-</div>
                    <div class="stat-label">M√©dia por Deputado</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="max-expense">-</div>
                    <div class="stat-label">Maior Gasto</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="deputy-count">-</div>
                    <div class="stat-label">Deputados Analisados</div>
                </div>
            </div>

            <div class="api-badge">
                Dados oficiais da C√¢mara dos Deputados
            </div>
        </div>

        <!-- Expense Chart -->
        <div class="chart-container">
            <h2 class="chart-title">Distribui√ß√£o de Gastos</h2>
            <p class="chart-description">Visualiza√ß√£o dos gastos parlamentares por deputado</p>

            <div class="expense-chart" id="expense-chart"></div>
        </div>

        <!-- Deputy Search and Filter -->
        <div class="chart-container">
            <h2 class="chart-title">Buscar Deputados</h2>
            <p class="chart-description">Encontre informa√ß√µes detalhadas sobre gastos espec√≠ficos</p>

            <div class="search-container">
                <input type="text" class="search-input" id="deputy-search" placeholder="Digite o nome do deputado...">
            </div>

            <!-- Summary Stats Section -->
            <div class="stats-section" id="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-deputies">-</div>
                        <div class="stat-label">Deputados Analisados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-expenses">-</div>
                        <div class="stat-label">Gasto Total em 2025</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-expense">-</div>
                        <div class="stat-label">M√©dia por Deputado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="top-spender">-</div>
                        <div class="stat-label">Maior Gastador</div>
                    </div>
                </div>
            </div>

            <!-- Top Spenders Chart -->
            <div class="chart-container" id="top-spenders-chart" style="display: block !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 1 !important;">
                <div class="chart-title">Top 10 Deputados - Maiores Gastos em 2025</div>
                <div class="chart-description">Ranking dos deputados com maiores despesas do ano</div>
                <div id="spenders-chart" style="min-height: 300px; background: rgba(255,255,255,0.9); border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem;"></div>
            </div>

            <div class="filters" id="party-filters">
                <button class="filter-btn active" data-party="all">Todos</button>
            </div>

            <div id="error" class="error" style="display: none;"></div>

            <div class="deputy-grid" id="deputy-grid"></div>

            <div class="load-more-container" id="load-more-container" style="display: none;">
                <button class="load-more-btn" id="load-more-btn">
                    Carregar Mais Deputados
                </button>
            </div>
        </div>

        <!-- Full-page loading overlay -->
        <div id="loading" class="loading-container">
            <div class="spinner"></div>
            <div class="loading-text">Carregando Dados das Despesas</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="loading-details" id="loading-details">
                Iniciando carregamento dos dados...
            </div>
        </div>
    </div>

    <script>
        // Load deputy data from existing file
        let deputyData = [];
        let expenseData = [];
        let allExpenseData = []; // Keep original unfiltered data
        let currentPage = 0;
        const PAGE_SIZE = 12; // Show 12 deputies per page

        // API configuration
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_BASE = isLocal ?
            'https://dadosabertos.camara.leg.br/api/v2' :
            '/api/proxy?endpoint=';
        const currentYear = new Date().getFullYear();

        function updateLoadingProgress(current, total, message) {
            const progressFill = document.getElementById('progress-fill');
            const loadingDetails = document.getElementById('loading-details');

            if (progressFill) {
                const percentage = (current / total) * 100;
                progressFill.style.width = `${percentage}%`;
            }

            if (loadingDetails) {
                loadingDetails.textContent = message;
            }
        }

        async function loadDeputyData() {
            try {
                updateLoadingProgress(0, 100, 'Carregando dados dos deputados...');

                const response = await fetch('data.js');
                const text = await response.text();

                updateLoadingProgress(25, 100, 'Processando dados dos deputados...');

                // Extract VISUALIZATION_DATA from the JavaScript file
                const dataMatch = text.match(/const\s+VISUALIZATION_DATA\s*=\s*(\{[\s\S]*?\});/);
                if (dataMatch) {
                    const visualizationData = JSON.parse(dataMatch[1]);

                    // Combine round1 and round2 data
                    deputyData = [...(visualizationData.round1 || [])];
                    if (visualizationData.round2) {
                        // Merge round2 data, updating existing entries or adding new ones
                        visualizationData.round2.forEach(deputy2 => {
                            const existingIndex = deputyData.findIndex(d => d.deputado === deputy2.deputado);
                            if (existingIndex >= 0) {
                                deputyData[existingIndex] = { ...deputyData[existingIndex], ...deputy2 };
                            } else {
                                deputyData.push(deputy2);
                            }
                        });
                    }

                    updateLoadingProgress(100, 100, 'Deputados carregados! Preparando p√°gina...');
                    console.log(`Loaded ${deputyData.length} deputies`);

                    // Initialize expense data with basic deputy info - show immediately
                    allExpenseData = deputyData.map(deputy => ({
                        nome: deputy.deputado,
                        partido: deputy.partido,
                        uf: deputy.estado,
                        voto: deputy.voto,
                        totalExpense: 0,
                        expenseCount: 0,
                        loading: true,
                        id: null,
                        expenses: []
                    }));
                    expenseData = [...allExpenseData]; // Start with all data

                    // Hide main loading, show content immediately
                    document.getElementById('loading').style.display = 'none';

                    // Setup filters and render with paginated data
                    renderPartyFilters();
                    renderCurrentPage();
                    setupLoadMoreButton();

                    // Initialize stats with basic counts
                    updateStatsDisplay();


                    // Initialize expense loading queue without blocking UI
                    initializeExpenseLoader();
                } else {
                    throw new Error('Could not parse VISUALIZATION_DATA');
                }
            } catch (error) {
                console.error('Error loading deputy data:', error);
                showError('Erro ao carregar dados dos deputados: ' + error.message);
            }
        }

        // Modern async queue system for loading expenses
        class ExpenseLoader {
            constructor() {
                this.queue = [];
                this.isProcessing = false;
                this.maxConcurrent = 2;
                this.retryAttempts = 3;
                this.baseDelay = 1000;
            }

            async fetchWithRetry(url, options = {}, attempts = this.retryAttempts) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);

                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    return await response.json();
                } catch (error) {
                    if (attempts > 1 && !error.name === 'AbortError') {
                        console.log(`Retrying ${url}, ${attempts - 1} attempts left`);
                        await this.delay(this.baseDelay * (this.retryAttempts - attempts + 1));
                        return this.fetchWithRetry(url, options, attempts - 1);
                    }
                    throw error;
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            async loadDeputyExpenses(deputy, index) {
                try {
                    // Search for deputy
                    const searchUrl = isLocal ?
                        `${API_BASE}/deputados?nome=${encodeURIComponent(deputy.deputado)}&ordem=ASC&ordenarPor=nome` :
                        `${API_BASE}deputados?nome=${encodeURIComponent(deputy.deputado)}&ordem=ASC&ordenarPor=nome`;

                    const searchData = await this.fetchWithRetry(searchUrl);

                    if (searchData.dados && searchData.dados.length > 0) {
                        const deputyInfo = searchData.dados[0];

                        // Get expenses
                        const expenseUrl = isLocal ?
                            `${API_BASE}/deputados/${deputyInfo.id}/despesas?ano=${currentYear}&ordem=ASC&ordenarPor=dataDocumento` :
                            `${API_BASE}deputados/${deputyInfo.id}/despesas?ano=${currentYear}&ordem=ASC&ordenarPor=dataDocumento`;

                        const expenseDataResponse = await this.fetchWithRetry(expenseUrl);

                        const totalExpense = expenseDataResponse.dados.reduce((sum, expense) => {
                            return sum + (expense.valorLiquido || 0);
                        }, 0);

                        // Update data atomically
                        this.updateDeputyData(index, {
                            totalExpense,
                            expenseCount: expenseDataResponse.dados.length,
                            id: deputyInfo.id,
                            expenses: expenseDataResponse.dados,
                            loading: false
                        });

                        console.log(`‚úÖ Loaded expenses for ${deputy.deputado}: ${formatCurrency(totalExpense)}`);
                        return true;
                    }
                } catch (error) {
                    console.warn(`‚ùå Failed to load ${deputy.deputado}:`, error.message);
                    // Mark as failed but don't break the queue
                    this.updateDeputyData(index, {
                        totalExpense: 0,
                        expenseCount: 0,
                        loading: false,
                        error: error.message
                    });
                }
                return false;
            }

            updateDeputyData(index, updates) {
                if (expenseData[index]) {
                    Object.assign(expenseData[index], updates);
                }
                if (allExpenseData[index]) {
                    Object.assign(allExpenseData[index], updates);
                }

                // Throttled UI updates
                if (!this.updateScheduled) {
                    this.updateScheduled = true;
                    setTimeout(() => {
                        renderDeputyGrid();
                        updateStatsDisplay();
                        updateTopSpendersChart();
                        this.updateScheduled = false;
                    }, 100);
                }
            }

            async processQueue() {
                if (this.isProcessing || this.queue.length === 0) return;

                this.isProcessing = true;
                console.log(`üîÑ Processing ${this.queue.length} deputies in expense queue`);

                const batch = this.queue.splice(0, this.maxConcurrent);
                const promises = batch.map(({deputy, index}) =>
                    this.loadDeputyExpenses(deputy, index)
                );

                await Promise.allSettled(promises);
                await this.delay(500); // Rate limiting

                this.isProcessing = false;

                if (this.queue.length > 0) {
                    setTimeout(() => this.processQueue(), 100);
                }
            }

            addToQueue(deputy, index) {
                this.queue.push({deputy, index});
                this.processQueue();
            }
        }

        const expenseLoader = new ExpenseLoader();

        function initializeExpenseLoader() {
            console.log('üöÄ Initializing modern expense loader');

            // Add first 15 deputies to the queue for immediate loading (covers full first page)
            const priority = deputyData.slice(0, 15);
            priority.forEach((deputy, index) => {
                expenseLoader.addToQueue(deputy, index);
            });

            console.log(`üìã Added ${priority.length} deputies to loading queue`);
        }

        async function loadExpenseData() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');

            try {
                // Load expenses for a sample of deputies (to avoid rate limiting)
                const sampleDeputies = deputyData.slice(0, 15);

                for (let i = 0; i < sampleDeputies.length; i++) {
                    const deputy = sampleDeputies[i];
                    const progress = 50 + ((i / sampleDeputies.length) * 50);

                    updateLoadingProgress(progress, 100, `Processando ${deputy.deputado} (${i + 1}/${sampleDeputies.length})...`);

                    try {
                        // First, search for the deputy by name to get their ID
                        const searchUrl = isLocal ?
                            `${API_BASE}/deputados?nome=${encodeURIComponent(deputy.deputado)}&ordem=ASC&ordenarPor=nome` :
                            `${API_BASE}deputados?nome=${encodeURIComponent(deputy.deputado)}&ordem=ASC&ordenarPor=nome`;

                        const searchResponse = await fetch(searchUrl);
                        if (searchResponse.ok) {
                            const searchData = await searchResponse.json();

                            if (searchData.dados && searchData.dados.length > 0) {
                                const deputyInfo = searchData.dados[0]; // Take the first match

                                // Now get their expenses
                                const expenseUrl = isLocal ?
                                    `${API_BASE}/deputados/${deputyInfo.id}/despesas?ano=${currentYear}&ordem=ASC&ordenarPor=dataDocumento` :
                                    `${API_BASE}deputados/${deputyInfo.id}/despesas?ano=${currentYear}&ordem=ASC&ordenarPor=dataDocumento`;

                                const expenseResponse = await fetch(expenseUrl);
                                if (expenseResponse.ok) {
                                    const expenseData_response = await expenseResponse.json();

                                    const totalExpense = expenseData_response.dados.reduce((sum, expense) => {
                                        return sum + (expense.valorLiquido || 0);
                                    }, 0);

                                    expenseData.push({
                                        nome: deputy.deputado,
                                        partido: deputy.partido,
                                        uf: deputy.estado,
                                        voto: deputy.voto,
                                        id: deputyInfo.id,
                                        expenses: expenseData_response.dados,
                                        totalExpense: totalExpense,
                                        expenseCount: expenseData_response.dados.length
                                    });
                                } else {
                                    // Add deputy with zero expenses if expense API fails
                                    expenseData.push({
                                        nome: deputy.deputado,
                                        partido: deputy.partido,
                                        uf: deputy.estado,
                                        voto: deputy.voto,
                                        id: deputyInfo.id,
                                        expenses: [],
                                        totalExpense: 0,
                                        expenseCount: 0
                                    });
                                }
                            } else {
                                console.warn(`Deputy not found: ${deputy.deputado}`);
                                // Add deputy with zero expenses if not found
                                expenseData.push({
                                    nome: deputy.deputado,
                                    partido: deputy.partido,
                                    uf: deputy.estado,
                                    voto: deputy.voto,
                                    id: null,
                                    expenses: [],
                                    totalExpense: 0,
                                    expenseCount: 0
                                });
                            }
                        } else {
                            // Add deputy with zero expenses if search API fails
                            expenseData.push({
                                nome: deputy.deputado,
                                partido: deputy.partido,
                                uf: deputy.estado,
                                voto: deputy.voto,
                                id: null,
                                expenses: [],
                                totalExpense: 0,
                                expenseCount: 0
                            });
                        }

                        // Small delay to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 200));
                    } catch (expenseError) {
                        console.warn(`Could not load data for ${deputy.deputado}:`, expenseError);
                        // Add deputy with zero expenses if API fails
                        expenseData.push({
                            nome: deputy.deputado,
                            partido: deputy.partido,
                            uf: deputy.estado,
                            voto: deputy.voto,
                            id: null,
                            expenses: [],
                            totalExpense: 0,
                            expenseCount: 0
                        });
                    }
                }

                updateLoadingProgress(100, 100, 'Finalizando carregamento...');

                // Small delay to show completion
                await new Promise(resolve => setTimeout(resolve, 500));

                loadingEl.style.display = 'none';
                renderExpenseData();

            } catch (error) {
                console.error('Error loading expense data:', error);
                showError('Erro ao carregar dados de despesas: ' + error.message);
            }
        }

        function showError(message) {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');

            loadingEl.style.display = 'none';
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function renderExpenseData() {
            renderStatistics();
            renderExpenseChart();
            renderPartyFilters();
            renderDeputyGrid();
        }

        function renderStatistics() {
            const totalExpenses = expenseData.reduce((sum, deputy) => sum + deputy.totalExpense, 0);
            const avgExpense = totalExpenses / expenseData.length;
            const maxExpense = Math.max(...expenseData.map(d => d.totalExpense));

            document.getElementById('total-expenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('avg-expense').textContent = formatCurrency(avgExpense);
            document.getElementById('max-expense').textContent = formatCurrency(maxExpense);
            document.getElementById('deputy-count').textContent = expenseData.length;
        }

        function renderExpenseChart() {
            console.log('üìä Starting renderExpenseChart (PIE CHART)');
            const chartEl = document.getElementById('expense-chart');
            chartEl.innerHTML = '';

            if (!allExpenseData || allExpenseData.length === 0) {
                console.log('‚ùå No expense data available for pie chart');
                chartEl.innerHTML = '<p style="text-align: center; padding: 2rem;">Dados n√£o dispon√≠veis</p>';
                return;
            }

            // Calculate expense distribution by category
            const categoryData = {};
            let totalAmount = 0;

            allExpenseData.forEach(deputy => {
                if (deputy.expenses && deputy.expenses.length > 0) {
                    deputy.expenses.forEach(expense => {
                        const category = expense.tipoDespesa || 'Outros';
                        const value = parseFloat(expense.valorLiquido) || 0;

                        if (!categoryData[category]) {
                            categoryData[category] = 0;
                        }
                        categoryData[category] += value;
                        totalAmount += value;
                    });
                }
            });

            // Convert to array and sort by value
            const pieData = Object.entries(categoryData)
                .map(([category, value]) => ({
                    category,
                    value,
                    percentage: (value / totalAmount * 100).toFixed(1)
                }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 8); // Top 8 categories

            console.log('üìä Pie chart data:', pieData);

            // Chart dimensions
            const width = chartEl.offsetWidth;
            const height = 400;
            const margin = 40;
            const radius = Math.min(width, height) / 2 - margin;

            // Create SVG
            const svg = d3.select(chartEl)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const g = svg.append('g')
                .attr('transform', `translate(${width/2}, ${height/2})`);

            // Color scale
            const color = d3.scaleOrdinal()
                .domain(pieData.map(d => d.category))
                .range(['#4f46e5', '#7c3aed', '#ec4899', '#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4']);

            // Create pie layout
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);

            // Create arc generator
            const arc = d3.arc()
                .innerRadius(0)
                .outerRadius(radius);

            // Create pie slices
            const slices = g.selectAll('.slice')
                .data(pie(pieData))
                .enter()
                .append('g')
                .attr('class', 'slice');

            // Add pie segments
            slices.append('path')
                .attr('d', arc)
                .attr('fill', d => color(d.data.category))
                .attr('stroke', 'white')
                .attr('stroke-width', 2)
                .style('opacity', 0.9)
                .on('mouseover', function(event, d) {
                    d3.select(this).style('opacity', 1);

                    // Show tooltip
                    const tooltip = d3.select('body').append('div')
                        .attr('class', 'tooltip')
                        .style('position', 'absolute')
                        .style('background', 'rgba(0,0,0,0.9)')
                        .style('color', 'white')
                        .style('padding', '12px')
                        .style('border-radius', '8px')
                        .style('pointer-events', 'none')
                        .style('font-size', '14px')
                        .style('box-shadow', '0 4px 12px rgba(0,0,0,0.3)')
                        .html(`
                            <strong>${d.data.category}</strong><br>
                            Valor: ${formatCurrency(d.data.value)}<br>
                            Porcentagem: ${d.data.percentage}%
                        `);

                    tooltip.style('left', (event.pageX + 10) + 'px')
                           .style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() {
                    d3.select(this).style('opacity', 0.9);
                    d3.selectAll('.tooltip').remove();
                });

            // Add labels
            slices.append('text')
                .attr('transform', d => `translate(${arc.centroid(d)})`)
                .attr('text-anchor', 'middle')
                .style('font-size', '12px')
                .style('font-weight', 'bold')
                .style('fill', 'white')
                .style('text-shadow', '1px 1px 2px rgba(0,0,0,0.7)')
                .text(d => d.data.percentage + '%');

            // Add legend
            const legend = svg.append('g')
                .attr('class', 'legend')
                .attr('transform', `translate(20, 20)`);

            const legendItems = legend.selectAll('.legend-item')
                .data(pieData.slice(0, 6)) // Show top 6 in legend
                .enter()
                .append('g')
                .attr('class', 'legend-item')
                .attr('transform', (d, i) => `translate(0, ${i * 25})`);

            legendItems.append('rect')
                .attr('width', 18)
                .attr('height', 18)
                .attr('fill', d => color(d.category));

            legendItems.append('text')
                .attr('x', 25)
                .attr('y', 9)
                .attr('dy', '0.35em')
                .style('font-size', '12px')
                .style('font-weight', '500')
                .text(d => {
                    const maxLength = 25;
                    return d.category.length > maxLength ?
                           d.category.substring(0, maxLength) + '...' :
                           d.category;
                });

            console.log('‚úÖ Pie chart created successfully');
        }

        function renderPartyFilters() {
            const parties = [...new Set(allExpenseData.map(d => d.partido))].sort();
            const filtersEl = document.getElementById('party-filters');

            // Clear existing filters except "Todos"
            filtersEl.innerHTML = '<button class="filter-btn active" data-party="all">Todos</button>';

            parties.forEach(party => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.dataset.party = party;
                btn.textContent = party;
                btn.addEventListener('click', () => filterByParty(party));
                filtersEl.appendChild(btn);
            });

            // Add event listener for "Todos" button
            filtersEl.querySelector('[data-party="all"]').addEventListener('click', () => filterByParty('all'));
        }

        function renderCurrentPage() {
            const startIndex = currentPage * PAGE_SIZE;
            const endIndex = startIndex + PAGE_SIZE;
            const currentPageData = expenseData.slice(startIndex, endIndex);

            if (currentPage === 0) {
                // First page - clear grid
                document.getElementById('deputy-grid').innerHTML = '';
            }

            renderDeputiesOnPage(currentPageData);
            updateLoadMoreButton();
        }

        function renderDeputiesOnPage(deputiesToRender) {
            const gridEl = document.getElementById('deputy-grid');

            deputiesToRender.forEach(deputy => {
                const card = document.createElement('div');
                card.className = 'deputy-card';

                // Show loading indicator or actual data
                const expenseDisplay = deputy.loading ?
                    '<div style="color: #94a3b8;">Carregando...</div>' :
                    formatCurrency(deputy.totalExpense);

                const detailsDisplay = deputy.loading ?
                    'Buscando dados de despesas...' :
                    `${deputy.expenseCount} despesas em ${currentYear}<br>Estado: ${deputy.uf || 'N/A'}`;

                card.innerHTML = `
                    <div class="deputy-header">
                        <div class="deputy-name">${deputy.nome}</div>
                        <div class="deputy-party">${deputy.partido}</div>
                    </div>
                    <div class="expense-total">${expenseDisplay}</div>
                    <div class="expense-details">
                        ${detailsDisplay}
                    </div>
                `;

                if (!deputy.loading) {
                    card.addEventListener('click', () => {
                        trackExpenseInteraction('deputy_click', deputy.nome);
                        showDeputyDetails(deputy);
                    });
                } else {
                    card.style.opacity = '0.7';
                }

                gridEl.appendChild(card);
            });
        }

        function setupLoadMoreButton() {
            const loadMoreBtn = document.getElementById('load-more-btn');
            const loadMoreContainer = document.getElementById('load-more-container');

            loadMoreBtn.addEventListener('click', () => {
                // Track GA event for load more interaction
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'load_more_deputies', {
                        event_category: 'despesas_interaction',
                        event_label: 'page_' + (currentPage + 1),
                        value: PAGE_SIZE
                    });
                }

                currentPage++;
                renderCurrentPage();

                // Load expense data for newly visible deputies
                const startIndex = (currentPage - 1) * PAGE_SIZE;
                const endIndex = currentPage * PAGE_SIZE;
                for (let i = startIndex; i < Math.min(endIndex, deputyData.length); i++) {
                    if (allExpenseData[i] && allExpenseData[i].loading && !allExpenseData[i].error) {
                        expenseLoader.addToQueue(deputyData[i], i);
                    }
                }
            });

            // Show the button initially
            loadMoreContainer.style.display = 'block';
            updateLoadMoreButton();
        }

        function updateLoadMoreButton() {
            const loadMoreBtn = document.getElementById('load-more-btn');
            const loadMoreContainer = document.getElementById('load-more-container');

            const totalShown = (currentPage + 1) * PAGE_SIZE;
            const hasMore = totalShown < expenseData.length;

            if (hasMore) {
                const remaining = expenseData.length - totalShown;
                const nextBatch = Math.min(PAGE_SIZE, remaining);
                loadMoreBtn.textContent = `Carregar Mais ${nextBatch} Deputados (${remaining} restantes)`;
                loadMoreBtn.disabled = false;
                loadMoreContainer.style.display = 'block';
            } else {
                loadMoreContainer.style.display = 'none';
            }
        }


        function updateStatsDisplay() {
            const totalDeputies = allExpenseData.length;
            const deputiesWithExpenses = allExpenseData.filter(d => !d.loading && d.totalExpense > 0);

            const totalExpenses = deputiesWithExpenses.reduce((sum, d) => sum + d.totalExpense, 0);
            const avgExpense = deputiesWithExpenses.length > 0 ? totalExpenses / deputiesWithExpenses.length : 0;

            const topSpender = deputiesWithExpenses.reduce((max, d) =>
                d.totalExpense > (max?.totalExpense || 0) ? d : max, null);

            const maxExpense = topSpender ? topSpender.totalExpense : 0;

            // Update ALL elements with these IDs (handle duplicates)
            document.querySelectorAll('#total-deputies').forEach(el => {
                el.textContent = totalDeputies.toLocaleString('pt-BR');
            });

            document.querySelectorAll('#total-expenses').forEach(el => {
                el.textContent = formatCurrency(totalExpenses);
            });

            document.querySelectorAll('#avg-expense').forEach(el => {
                el.textContent = formatCurrency(avgExpense);
            });

            document.querySelectorAll('#top-spender').forEach(el => {
                el.textContent = topSpender ? topSpender.nome.split(' ')[0] : 'Carregando...';
            });

            // Update other unique stats if they exist
            const maxExpenseEl = document.getElementById('max-expense');
            if (maxExpenseEl) {
                maxExpenseEl.textContent = formatCurrency(maxExpense);
            }

            const deputyCountEl = document.getElementById('deputy-count');
            if (deputyCountEl) {
                deputyCountEl.textContent = totalDeputies.toLocaleString('pt-BR');
            }

            console.log('Stats updated:', { totalDeputies, totalExpenses, avgExpense, maxExpense, topSpender: topSpender?.nome });
        }

        function updateTopSpendersChart() {
            console.log('=== CHART DEBUG START ===');
            console.log('All expense data length:', allExpenseData.length);
            console.log('Sample expense data:', allExpenseData.slice(0, 3));

            const deputiesWithExpenses = allExpenseData.filter(d => !d.loading && d.totalExpense > 0);
            console.log('Deputies with expenses:', deputiesWithExpenses.length);
            console.log('Sample deputies with expenses:', deputiesWithExpenses.slice(0, 3));

            const chartContainer = document.getElementById('spenders-chart');
            console.log('Chart container found:', !!chartContainer);

            if (!chartContainer) {
                console.error('Chart container not found!');
                return;
            }

            // ALWAYS show something
            if (deputiesWithExpenses.length === 0) {
                console.log('No deputies with expenses - keeping mock chart or showing loading');
                // Don't clear the container if it already has content (mock chart)
                if (chartContainer.children.length === 0) {
                    chartContainer.innerHTML = '<div style="text-align: center; color: #64748b; padding: 2rem; background: rgba(255,255,255,0.8); border-radius: 8px;">Carregando dados de despesas...</div>';
                    chartContainer.style.minHeight = '200px';
                }
                return;
            }

            const topSpenders = deputiesWithExpenses
                .sort((a, b) => b.totalExpense - a.totalExpense)
                .slice(0, 10);

            console.log('Top spenders:', topSpenders.map(d => ({ name: d.nome, expense: d.totalExpense })));

            // Use the same simple approach as the test chart
            chartContainer.innerHTML = `
                <div style="padding: 20px; background: white; border: 2px solid black; margin: 10px;">
                    <h3 style="color: black; margin: 0 0 15px 0;">‚úÖ REAL CHART WITH DATA!</h3>
                    ${topSpenders.map((deputy, index) => {
                        const percentage = (deputy.totalExpense / maxExpense) * 100;
                        const colors = ['red', 'blue', 'green', 'orange', 'purple', 'brown', 'pink', 'gray', 'cyan', 'magenta'];
                        return `<div style="background: ${colors[index] || 'black'}; height: 30px; width: ${percentage}%; margin: 10px 0; color: white; padding: 5px; box-sizing: border-box;">${deputy.nome} - R$ ${deputy.totalExpense.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>`;
                    }).join('')}
                </div>
            `;

            console.log('Real chart created with simple HTML approach!');

            // Create simple bar chart
            const maxExpense = topSpenders[0]?.totalExpense || 0;
            console.log('Max expense for scaling:', maxExpense);

            if (topSpenders.length > 0) {
                topSpenders.forEach((deputy, index) => {
                    console.log(`Creating bar ${index + 1} for ${deputy.nome}`);

                    const barContainer = document.createElement('div');
                    barContainer.style.cssText = `
                        display: flex !important;
                        align-items: center;
                        margin-bottom: 12px;
                        font-size: 0.9rem;
                        padding: 8px;
                        background: rgba(255, 255, 255, 0.8) !important;
                        border-radius: 8px;
                        border: 1px solid #e2e8f0;
                        min-height: 40px;
                    `;

                    const percentage = maxExpense > 0 ? (deputy.totalExpense / maxExpense) * 100 : 0;
                    console.log(`Bar ${index + 1} percentage: ${percentage}%`);

                    barContainer.innerHTML = `
                        <div style="width: 25%; padding-right: 12px; font-weight: 500; color: #0f172a;">${deputy.nome.split(' ').slice(0, 2).join(' ')}</div>
                        <div style="width: 20%; padding-right: 8px; font-size: 0.8rem; color: #64748b;">${deputy.partido}</div>
                        <div style="width: 35%; background: #e2e8f0; border-radius: 6px; height: 24px; position: relative;">
                            <div style="width: ${percentage}%; background: linear-gradient(135deg, #ef4444, #dc2626); height: 100%; border-radius: 6px; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="width: 20%; padding-left: 12px; text-align: right; font-weight: 600; color: #0f172a; font-size: 0.9rem;">
                            ${formatCurrency(deputy.totalExpense)}
                        </div>
                    `;

                    chartContainer.appendChild(barContainer);
                    console.log(`Bar ${index + 1} added to container`);
                    console.log('Current container children count:', chartContainer.children.length);
                    console.log('Container innerHTML length:', chartContainer.innerHTML.length);
                });
            } else {
                console.log('No top spenders to display');
                chartContainer.innerHTML = '<div style="text-align: center; color: #dc2626; padding: 2rem; background: rgba(255,255,255,0.8); border-radius: 8px;">Nenhum dado de despesas dispon√≠vel</div>';
            }


            console.log('Final chart container HTML:', chartContainer.innerHTML.substring(0, 200) + '...');
            console.log('Final container children count:', chartContainer.children.length);
            console.log('Container scroll height:', chartContainer.scrollHeight);
            console.log('Container computed styles:', window.getComputedStyle(chartContainer));
            console.log('Container bounding rect:', chartContainer.getBoundingClientRect());

            // Check again in 1 second to see if something clears it
            setTimeout(() => {
                console.log('=== 1 SECOND LATER CHECK ===');
                console.log('Container still has children?', chartContainer.children.length);
                console.log('Container innerHTML still populated?', chartContainer.innerHTML.length > 0);
                console.log('Container visible?', chartContainer.getBoundingClientRect().height > 0);
            }, 1000);

            console.log('=== CHART DEBUG END ===');
        }

        function renderDeputyGrid(filteredData = expenseData) {
            // Legacy function for backwards compatibility - now just resets pagination
            expenseData = filteredData;
            currentPage = 0;
            renderCurrentPage();
        }

        function filterByParty(party) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-party="${party}"]`).classList.add('active');

            // Filter data from original dataset
            expenseData = party === 'all' ?
                [...allExpenseData] :
                allExpenseData.filter(d => d.partido === party);

            // Reset pagination and show filtered results
            currentPage = 0;
            renderCurrentPage();
            trackExpenseInteraction('filter_party', party);
        }

        function setupSearch() {
            const searchInput = document.getElementById('deputy-search');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredData = expenseData.filter(deputy =>
                    deputy.nome.toLowerCase().includes(query)
                );
                renderDeputyGrid(filteredData);

                if (query) {
                    trackExpenseInteraction('search', query);
                }
            });
        }

        function showDeputyDetails(deputy) {
            const details = `
Deputado: ${deputy.nome}
Partido: ${deputy.partido} - ${deputy.uf}
Gasto Total em ${currentYear}: ${formatCurrency(deputy.totalExpense)}
N√∫mero de Despesas: ${deputy.expenseCount}

Voto na PEC: ${deputy.voto || 'N√£o registrado'}
            `;

            alert(details);
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            loadDeputyData();
            setupSearch();
        });
    </script>

    <div class="footer" style="background: rgba(30, 41, 59, 0.95); color: white; padding: 2rem; margin-top: 3rem; text-align: center;">
        <div class="footer-content" style="max-width: 1200px; margin: 0 auto;">
            <div id="version-info" style="margin: 1rem 0; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <!-- Version info will be injected here by version.js -->
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #94a3b8;">
                <a href="index.html" style="color: #3b82f6; text-decoration: none;">‚Üê Voltar ao in√≠cio</a> |
                Criado por <a href="https://github.com/fcavalcantirj" style="color: #3b82f6; text-decoration: none;">fcavalcantirj</a>
            </p>
        </div>
    </div>

    <script src="version.js"></script>
</body>
</html>